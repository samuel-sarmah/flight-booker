<% content_for :title, "OpenFlight - Book Your Flight" %>

<!-- Quick Links Section -->
<div class="card card--enhanced mb-xl" style="max-width: 700px; margin-left: auto; margin-right: auto;">
  <div class="card__header text-center">
    <h3 class="card__title">Welcome to OpenFlight</h3>
    <p class="card__subtitle">Professional flight booking made simple and secure</p>
  </div>
  <div class="card__body">
    <div class="action-grid">
      <div class="action-card">
        <div class="action-card__icon">üîç</div>
        <h4 class="action-card__title">Search Flights</h4>
        <p class="action-card__description">Find your perfect flight from our extensive network</p>
        <%= link_to "Start Search", "#", class: "btn btn-primary btn-lg", onclick: "document.querySelector('.search-section').scrollIntoView({behavior: 'smooth'})" %>
      </div>
      
      <div class="action-card">
        <div class="action-card__icon">üìã</div>
        <h4 class="action-card__title">Existing Booking</h4>
        <p class="action-card__description">Access your booking details using your reference</p>
        <%= link_to "Find Booking", lookup_bookings_path, class: "btn btn-secondary btn-lg" %>
      </div>
    </div>
  </div>
</div>

<!-- Progress Steps -->
<nav class="progress-steps progress-steps--enhanced" aria-label="Booking progress">
  <div class="progress-step progress-step--active">
    <span class="progress-step__number">1</span>
    <span class="progress-step__label">Search</span>
  </div>
  <div class="progress-step__divider"></div>
  <div class="progress-step">
    <span class="progress-step__number">2</span>
    <span class="progress-step__label">Passengers</span>
  </div>
  <div class="progress-step__divider"></div>
  <div class="progress-step">
    <span class="progress-step__number">3</span>
    <span class="progress-step__label">Confirm</span>
  </div>
</nav>

<!-- Search Form -->
<section class="search-section">
  <div class="container">
    <div class="card card--enhanced card--search">
      <div class="card__header">
        <h2 class="card__title">Search Flights</h2>
        <p class="card__subtitle">Find your perfect flight from our extensive network</p>
      </div>
      <div class="card__body">
        <%= form_with url: flights_path, method: :get, local: true, class: "search-form search-form--enhanced", 
                      data: { controller: "flight-search", turbo_frame: "flight-results" } do |f| %>
          
          <div class="search-form__grid">
            <div class="form-group">
              <%= f.label :departure_airport_id, "From", class: "form-label form-label--enhanced" %>
              <%= f.select :departure_airport_id, @airport_options, 
                  { include_blank: "Select departure" },
                  { class: "form-select form-input form-input--enhanced", 
                    data: { flight_search_target: "departure", action: "change->flight-search#validate" } } %>
            </div>

            <div class="form-group">
              <%= f.label :arrival_airport_id, "To", class: "form-label form-label--enhanced" %>
              <%= f.select :arrival_airport_id, @airport_options, 
                  { include_blank: "Select destination" },
                  { class: "form-select form-input form-input--enhanced", 
                    data: { flight_search_target: "arrival", action: "change->flight-search#validate" } } %>
            </div>
          </div>

          <div class="search-form__row">
            <div class="form-group">
              <%= f.label :startdatetime, "Departure Date", class: "form-label form-label--enhanced" %>
              <%= f.date_field :startdatetime, 
                  min: Date.today, 
                  max: Date.today + 365.days,
                  value: params[:startdatetime] || Date.today,
                  class: "form-input form-input--enhanced",
                  data: { flight_search_target: "date", action: "change->flight-search#validate" } %>
            </div>

            <div class="form-group">
              <%= f.label :passengers, "Passengers", class: "form-label form-label--enhanced" %>
              <%= f.select :passengers, @passenger_options,
                  { selected: params[:passengers] || 1 },
                  { class: "form-select form-input form-input--enhanced", 
                    data: { flight_search_target: "passengers" } } %>
            </div>

            <div class="form-group" style="display: flex; align-items: flex-end;">
              <%= f.submit "Search Flights", 
                  class: "btn btn-primary btn-lg btn-enhanced",
                  data: { flight_search_target: "submit" } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</section>

<!-- Features Section -->
<section class="features-section">
  <div class="container">
    <h2 class="section-title text-center mb-xl">Why Choose OpenFlight?</h2>
    
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-card__icon"></div>
        <h3 class="feature-card__title">Global Network</h3>
        <p class="feature-card__description">Access to thousands of routes worldwide with competitive pricing</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-card__icon"></div>
        <h3 class="feature-card__title">Premium Service</h3>
        <p class="feature-card__description">Professional customer support and seamless booking experience</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-card__icon"></div>
        <h3 class="feature-card__title">Secure & Reliable</h3>
        <p class="feature-card__description">Your data and payments protected with industry-leading security</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-card__icon"></div>
        <h3 class="feature-card__title">Fast & Easy</h3>
        <p class="feature-card__description">Book your flight in minutes with our streamlined process</p>
      </div>
    </div>
  </div>
</section>


<!-- Flight Results -->
<turbo-frame id="flight-results">
  <% if @flights.any? %>
    <section class="flights-section">
      <div class="container">
        <h2 class="flights-section__title">
          <%= pluralize(@flights.count, "flight") %> available
        </h2>

        <%= form_with url: new_booking_path, method: :get, local: true,
                      data: { controller: "flight-select", turbo_frame: "_top" } do %>
          
          <div class="flight-list flight-list--enhanced">
            <% @flights.each_with_index do |flight, index| %>
              <div class="flight-card flight-card--enhanced" 
                   data-flight-select-target="card"
                   data-action="click->flight-select#select">
                
                <div class="flight-card__departure">
                  <span class="flight-card__code"><%= flight.departure_airport.airport_code %></span>
                  <span class="flight-card__city"><%= flight.departure_airport.airport_name.split(',').first %></span>
                  <span class="flight-card__time"><%= flight.startdatetime.strftime("%H:%M") %></span>
                </div>

                <div class="flight-card__route">
                  <span class="flight-card__duration"><%= flight.flight_duration %> min</span>
                  <div class="flight-card__line">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 2L2 22M22 2L15 22L11 13L2 9L22 2Z"/>
                    </svg>
                  </div>
                  <span class="flight-card__duration">Direct</span>
                </div>

                <div class="flight-card__arrival">
                  <span class="flight-card__code"><%= flight.arrival_airport.airport_code %></span>
                  <span class="flight-card__city"><%= flight.arrival_airport.airport_name.split(',').first %></span>
                  <span class="flight-card__time"><%= (flight.startdatetime + flight.flight_duration.minutes).strftime("%H:%M") %></span>
                </div>

                <div class="flight-card__price">
                  <span class="flight-card__amount">$<%= rand(150..800) %></span>
                  <span class="flight-card__per-person">per person</span>
                  <%= radio_button_tag :flight_id, flight.id, index == 0, 
                      class: "flight-card__radio sr-only",
                      data: { flight_select_target: "radio" } %>
                </div>
              </div>
            <% end %>
          </div>

          <%= hidden_field_tag :passengers, params[:passengers] %>
          
          <div class="flex flex-end mt-xl">
            <button type="submit" class="btn btn-primary btn-lg btn-enhanced" 
                    data-flight-select-target="submit">
              Continue to Passengers
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        <% end %>
      </div>
    </section>

  <% elsif params[:departure_airport_id].present? || params[:arrival_airport_id].present? %>
    <section class="flights-section">
      <div class="container">
        <div class="empty-state empty-state--enhanced">
          <div class="empty-state__icon">üîç</div>
          <h3 class="empty-state__title">No flights found for your search</h3>
          <p class="empty-state__description">
            Try different dates or destinations. Here are some upcoming flights you might like:
          </p>
        </div>
      </div>
    </section>
  <% end %>
</turbo-frame>